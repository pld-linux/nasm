--- nasm-0.98.32/output/outelf.c	Fri May 17 06:51:10 2002
+++ nasm-0.98.32/output/outelf.c.org	Tue May 21 11:32:55 2002
@@ -568,7 +568,7 @@
 	r->symbol = 0;
 	for (i=0; i<nsects; i++)
 	    if (segment == sects[i]->index)
-		r->symbol = i+3;
+		r->symbol = i+2;
 	if (!r->symbol)
 	    r->symbol = GLOBAL_TEMP_BASE + raa_read(bsym, segment);
     }
@@ -975,13 +975,13 @@
      * Now some standard symbols defining the segments, for relocation
      * purposes.
      */
-    for (i = 1; i <= nsects+1; i++) {
+    for (i = 1; i <= nsects; i++) {
 	p = entry;
 	WRITELONG (p, 0);	       /* no symbol name */
 	WRITELONG (p, 0);	       /* offset zero */
 	WRITELONG (p, 0);	       /* size zero */
 	WRITESHORT (p, 3);	       /* local section-type thing */
-	WRITESHORT (p, (i==1 ? SHN_ABS : i-1));   /* the section id */
+	WRITESHORT (p, i);
 	saa_wbytes (s, entry, 16L);
 	*len += 16;
 	(*local)++;
@@ -1039,7 +1039,7 @@
 	long sym = r->symbol;
 
 	if (sym >= GLOBAL_TEMP_BASE)
-	    sym += -GLOBAL_TEMP_BASE + (nsects+3) + nlocals;
+	    sym += -GLOBAL_TEMP_BASE + (nsects+2) + nlocals;
 
 	p = entry;
 	WRITELONG (p, r->address);
